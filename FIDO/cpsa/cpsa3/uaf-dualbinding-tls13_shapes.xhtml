<?xml version="1.0"?>
<!-- CPSA 3.6.11 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>UAF using TLS1.3 with dual (server/client) exporter binding.</title>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <style>
  svg.diagram { border-width: 1px; border-style: solid }
 </style>
</head>
<body>

<pre>(comment &quot;CPSA 3.6.11&quot;)
(comment &quot;Extracted shapes&quot;)
(herald &quot;UAF using TLS1.3 with dual (server/client) exporter binding.&quot;
  (algebra diffie-hellman))
(comment &quot;CPSA 3.6.11&quot;)
(comment &quot;All input read from uaf-dualbinding-tls13.scm&quot;)</pre>

<p id="top">Trees: <a href="#t0">0</a> <a href="#t26">26</a> <a href="#t52">52</a> <a href="#t140">140</a>.</p>

<p id="t0">Tree <a href="#top">0</a>, POV <a href="#k0">0</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k8&quot;, &quot;_self&quot;)'>8</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k0&quot;, &quot;_self&quot;)'>0</text>
  </svg></div>

<pre>(defprotocol uaf-dualbinding-tls13 diffie-hellman
  (defrole client-reg
    (vars (username auth server ca appid name) (challenge text)
      (cr sr data) (authk spk akey) (x rndx) (y expt))
    (trace (send (cat cr (exp (gen) x)))
      (recv
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (send
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (recv
        (enc username appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr username appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (send
        (enc (hash &quot;key handle&quot; (invk authk) username)
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen x))
  (defrole client-auth
    (vars (auth server ca appid name) (challenge text) (cr sr data)
      (authk spk akey) (x rndx) (y expt))
    (trace (send (cat cr (exp (gen) x)))
      (recv
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (send
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (recv
        (enc appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (send
        (enc
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen x))
  (defrole server-reg
    (vars (username auth server ca appid name) (challenge text)
      (cr sr data) (authk spk akey) (x expt) (y rndx))
    (trace (recv (cat cr (exp (gen) x)))
      (send
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (recv
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (send
        (enc username appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr username appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (recv
        (enc (hash &quot;key handle&quot; (invk authk) username)
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen y)
    (absent (y (exp (gen) x))))
  (defrole server-auth
    (vars (auth server ca appid name) (challenge text) (cr sr data)
      (authk spk akey) (x expt) (y rndx))
    (trace (recv (cat cr (exp (gen) x)))
      (send
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (recv
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (send
        (enc appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (recv
        (enc
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen y)
    (absent (y (exp (gen) x)))))</pre>

<p id="k0">Item <a href="#t0">0</a>, Child: <a href="#k8">8</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc (hash &quot;key handle&quot; (invk authk) username) (cat auth authk (hash appid challenge (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server))) (enc auth authk (hash appid challenge (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server)) (invk authk)) (hash &quot;c ap traffic&quot; cr sr (hash (exp (gen) (mul x y)) &quot;derived&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc username appid challenge (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server) (hash &quot;s ap traffic&quot; cr sr (hash (exp (gen) (mul x y)) &quot;derived&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc (hash (hash &quot;finished&quot; (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)))) (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat (cat sr (exp (gen) y)) (enc (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk))) (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr)))</title>
   <circle style='fill: red;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(cat cr (exp (gen) x))</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((challenge challenge) (cr cr) (sr sr) (username username) (auth auth) (server server) (ca ca) (appid appid) (authk authk) (spk spk) (x x) (y y))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>client-reg</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>uaf-dualbinding-tls13 0</text></svg>
 </div>

<pre>(defskeleton uaf-dualbinding-tls13
  (vars (challenge text) (cr sr data)
    (server ca appid username auth name) (authk spk akey) (x rndx)
    (y expt))
  (defstrand client-reg 5 (challenge challenge) (cr cr) (sr sr)
    (username username) (auth auth) (server server) (ca ca)
    (appid appid) (authk authk) (spk spk) (x x) (y y))
  (non-orig (invk authk) (invk spk) (privk ca))
  (uniq-gen x)
  (uniq-orig cr)
  (goals
    (forall
      ((cr sr data) (challenge text) (authk spk akey)
        (server ca appid name) (x rndx) (z strd))
      (implies
        (and (p &quot;client-reg&quot; z 5) (p &quot;client-reg&quot; &quot;cr&quot; z cr)
          (p &quot;client-reg&quot; &quot;sr&quot; z sr)
          (p &quot;client-reg&quot; &quot;challenge&quot; z challenge)
          (p &quot;client-reg&quot; &quot;authk&quot; z authk) (p &quot;client-reg&quot; &quot;spk&quot; z spk)
          (p &quot;client-reg&quot; &quot;appid&quot; z appid)
          (p &quot;client-reg&quot; &quot;server&quot; z server) (p &quot;client-reg&quot; &quot;ca&quot; z ca)
          (p &quot;client-reg&quot; &quot;x&quot; z x) (non (invk authk)) (non (invk spk))
          (non (privk ca)) (ugen x) (uniq-at cr z 0))
        (exists ((z-0 strd))
          (and (p &quot;server-reg&quot; z-0 4)
            (p &quot;server-reg&quot; &quot;challenge&quot; z-0 challenge)
            (p &quot;server-reg&quot; &quot;appid&quot; z-0 appid)
            (p &quot;server-reg&quot; &quot;server&quot; z-0 server))))))
  (label 0)
  (unrealized (0 1))
  (origs (cr (0 0)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k8">Item <a href="#t0">8</a>, Parent: <a href="#k0">0</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc username appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server) (hash &quot;s ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)))) (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat (cat sr (exp (gen) y)) (enc (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk))) (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(cat cr (exp (gen) x))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc (hash &quot;key handle&quot; (invk authk) username) (cat auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server))) (enc auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server)) (invk authk)) (hash &quot;c ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc username appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server) (hash &quot;s ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)))) (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat (cat sr (exp (gen) y)) (enc (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk))) (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)))</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(cat cr (exp (gen) x))</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((challenge challenge) (cr cr) (sr sr) (username username) (server server) (ca ca) (appid appid) (spk spk) (x x) (y y))</title>
   <text
    x='139.920' y='77.460'
    style='text-anchor: middle;'>server-reg</text></g>
  <g>
   <title>((challenge challenge) (cr cr) (sr sr) (username username) (auth auth) (server server) (ca ca) (appid appid) (authk authk) (spk spk) (x x) (y y))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>client-reg</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>uaf-dualbinding-tls13 8 (realized)</text>
  </svg></div>

<pre>(defskeleton uaf-dualbinding-tls13
  (vars (challenge text) (cr sr data)
    (server appid username auth ca name) (authk spk akey) (y x rndx))
  (defstrand client-reg 5 (challenge challenge) (cr cr) (sr sr)
    (username username) (auth auth) (server server) (ca ca)
    (appid appid) (authk authk) (spk spk) (x x) (y y))
  (defstrand server-reg 4 (challenge challenge) (cr cr) (sr sr)
    (username username) (server server) (ca ca) (appid appid) (spk spk)
    (x x) (y y))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3)))
  (absent (y (exp (gen) x)))
  (non-orig (invk authk) (invk spk) (privk ca))
  (uniq-gen y x)
  (uniq-orig cr)
  (operation encryption-test (displaced 2 0 client-auth 3)
    (enc
      (hash
        (hash &quot;finished&quot;
          (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))
        (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
        (cat server spk (enc (hash server spk) (privk ca)))
        (enc
          (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk
            (enc (hash server spk) (privk ca))) (invk spk))
        (hash
          (hash &quot;finished&quot;
            (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr))
          (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
          (cat server spk (enc (hash server spk) (privk ca)))
          (enc
            (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
              spk (enc (hash server spk) (privk ca))) (invk spk))))
      (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (1 2))
  (label 8)
  (parent 0)
  (unrealized)
  (shape)
  (satisfies yes)
  (maps
    ((0)
      ((cr cr) (sr sr) (challenge challenge) (authk authk) (spk spk)
        (server server) (ca ca) (appid appid) (x x) (username username)
        (auth auth) (y y))))
  (origs (cr (0 0))))</pre>

<p id="t26">Tree <a href="#top">26</a>, POV <a href="#k26">26</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k34&quot;, &quot;_self&quot;)'>34</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k26&quot;, &quot;_self&quot;)'>26</text>
  </svg></div>

<pre>(defprotocol uaf-dualbinding-tls13 diffie-hellman
  (defrole client-reg
    (vars (username auth server ca appid name) (challenge text)
      (cr sr data) (authk spk akey) (x rndx) (y expt))
    (trace (send (cat cr (exp (gen) x)))
      (recv
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (send
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (recv
        (enc username appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr username appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (send
        (enc (hash &quot;key handle&quot; (invk authk) username)
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen x))
  (defrole client-auth
    (vars (auth server ca appid name) (challenge text) (cr sr data)
      (authk spk akey) (x rndx) (y expt))
    (trace (send (cat cr (exp (gen) x)))
      (recv
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (send
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (recv
        (enc appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (send
        (enc
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen x))
  (defrole server-reg
    (vars (username auth server ca appid name) (challenge text)
      (cr sr data) (authk spk akey) (x expt) (y rndx))
    (trace (recv (cat cr (exp (gen) x)))
      (send
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (recv
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (send
        (enc username appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr username appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (recv
        (enc (hash &quot;key handle&quot; (invk authk) username)
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen y)
    (absent (y (exp (gen) x))))
  (defrole server-auth
    (vars (auth server ca appid name) (challenge text) (cr sr data)
      (authk spk akey) (x expt) (y rndx))
    (trace (recv (cat cr (exp (gen) x)))
      (send
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (recv
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (send
        (enc appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (recv
        (enc
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen y)
    (absent (y (exp (gen) x)))))</pre>

<p id="k26">Item <a href="#t26">26</a>, Child: <a href="#k34">34</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc (cat auth authk (hash appid challenge (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server))) (enc auth authk (hash appid challenge (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server)) (invk authk)) (hash &quot;c ap traffic&quot; cr sr (hash (exp (gen) (mul x y)) &quot;derived&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc appid challenge (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server) (hash &quot;s ap traffic&quot; cr sr (hash (exp (gen) (mul x y)) &quot;derived&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc (hash (hash &quot;finished&quot; (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)))) (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat (cat sr (exp (gen) y)) (enc (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk))) (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr)))</title>
   <circle style='fill: red;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(cat cr (exp (gen) x))</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((challenge challenge) (cr cr) (sr sr) (auth auth) (server server) (ca ca) (appid appid) (authk authk) (spk spk) (x x) (y y))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>client-auth</text></g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>uaf-dualbinding-tls13 26</text></svg>
 </div>

<pre>(defskeleton uaf-dualbinding-tls13
  (vars (challenge text) (cr sr data) (server ca appid auth name)
    (authk spk akey) (x rndx) (y expt))
  (defstrand client-auth 5 (challenge challenge) (cr cr) (sr sr)
    (auth auth) (server server) (ca ca) (appid appid) (authk authk)
    (spk spk) (x x) (y y))
  (non-orig (invk authk) (invk spk) (privk ca))
  (uniq-gen x)
  (uniq-orig cr)
  (goals
    (forall
      ((cr sr data) (challenge text) (authk spk akey)
        (server ca appid name) (x rndx) (z strd))
      (implies
        (and (p &quot;client-auth&quot; z 5) (p &quot;client-auth&quot; &quot;cr&quot; z cr)
          (p &quot;client-auth&quot; &quot;sr&quot; z sr)
          (p &quot;client-auth&quot; &quot;challenge&quot; z challenge)
          (p &quot;client-auth&quot; &quot;authk&quot; z authk)
          (p &quot;client-auth&quot; &quot;spk&quot; z spk)
          (p &quot;client-auth&quot; &quot;appid&quot; z appid)
          (p &quot;client-auth&quot; &quot;server&quot; z server)
          (p &quot;client-auth&quot; &quot;ca&quot; z ca) (p &quot;client-auth&quot; &quot;x&quot; z x)
          (non (invk authk)) (non (invk spk)) (non (privk ca)) (ugen x)
          (uniq-at cr z 0))
        (exists ((z-0 strd))
          (and (p &quot;server-auth&quot; z-0 4)
            (p &quot;server-auth&quot; &quot;challenge&quot; z-0 challenge)
            (p &quot;server-auth&quot; &quot;appid&quot; z-0 appid)
            (p &quot;server-auth&quot; &quot;server&quot; z-0 server))))))
  (label 26)
  (unrealized (0 1))
  (origs (cr (0 0)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k34">Item <a href="#t26">34</a>, Parent: <a href="#k26">26</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server) (hash &quot;s ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)))) (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat (cat sr (exp (gen) y)) (enc (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk))) (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(cat cr (exp (gen) x))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc (cat auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server))) (enc auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server)) (invk authk)) (hash &quot;c ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server) (hash &quot;s ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)))) (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat (cat sr (exp (gen) y)) (enc (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk))) (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)))</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(cat cr (exp (gen) x))</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((challenge challenge) (cr cr) (sr sr) (server server) (ca ca) (appid appid) (spk spk) (x x) (y y))</title>
   <text
    x='139.920' y='77.460'
    style='text-anchor: middle;'>server-auth</text></g>
  <g>
   <title>((challenge challenge) (cr cr) (sr sr) (auth auth) (server server) (ca ca) (appid appid) (authk authk) (spk spk) (x x) (y y))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>client-auth</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>uaf-dualbinding-tls13 34 (realized)</text>
  </svg></div>

<pre>(defskeleton uaf-dualbinding-tls13
  (vars (challenge text) (cr sr data) (server appid auth ca name)
    (authk spk akey) (y x rndx))
  (defstrand client-auth 5 (challenge challenge) (cr cr) (sr sr)
    (auth auth) (server server) (ca ca) (appid appid) (authk authk)
    (spk spk) (x x) (y y))
  (defstrand server-auth 4 (challenge challenge) (cr cr) (sr sr)
    (server server) (ca ca) (appid appid) (spk spk) (x x) (y y))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3)))
  (absent (y (exp (gen) x)))
  (non-orig (invk authk) (invk spk) (privk ca))
  (uniq-gen y x)
  (uniq-orig cr)
  (operation encryption-test (displaced 2 0 client-auth 3)
    (enc
      (hash
        (hash &quot;finished&quot;
          (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))
        (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
        (cat server spk (enc (hash server spk) (privk ca)))
        (enc
          (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk
            (enc (hash server spk) (privk ca))) (invk spk))
        (hash
          (hash &quot;finished&quot;
            (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr))
          (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
          (cat server spk (enc (hash server spk) (privk ca)))
          (enc
            (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
              spk (enc (hash server spk) (privk ca))) (invk spk))))
      (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (1 2))
  (label 34)
  (parent 26)
  (unrealized)
  (shape)
  (satisfies yes)
  (maps
    ((0)
      ((cr cr) (sr sr) (challenge challenge) (authk authk) (spk spk)
        (server server) (ca ca) (appid appid) (x x) (auth auth) (y y))))
  (origs (cr (0 0))))</pre>

<p id="t52">Tree <a href="#top">52</a>, POV <a href="#k52">52</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k60&quot;, &quot;_self&quot;)'>60</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k52&quot;, &quot;_self&quot;)'>52</text>
  </svg></div>

<pre>(defprotocol uaf-dualbinding-tls13 diffie-hellman
  (defrole client-reg
    (vars (username auth server ca appid name) (challenge text)
      (cr sr data) (authk spk akey) (x rndx) (y expt))
    (trace (send (cat cr (exp (gen) x)))
      (recv
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (send
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (recv
        (enc username appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr username appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (send
        (enc (hash &quot;key handle&quot; (invk authk) username)
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen x))
  (defrole client-auth
    (vars (auth server ca appid name) (challenge text) (cr sr data)
      (authk spk akey) (x rndx) (y expt))
    (trace (send (cat cr (exp (gen) x)))
      (recv
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (send
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (recv
        (enc appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (send
        (enc
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen x))
  (defrole server-reg
    (vars (username auth server ca appid name) (challenge text)
      (cr sr data) (authk spk akey) (x expt) (y rndx))
    (trace (recv (cat cr (exp (gen) x)))
      (send
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (recv
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (send
        (enc username appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr username appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (recv
        (enc (hash &quot;key handle&quot; (invk authk) username)
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen y)
    (absent (y (exp (gen) x))))
  (defrole server-auth
    (vars (auth server ca appid name) (challenge text) (cr sr data)
      (authk spk akey) (x expt) (y rndx))
    (trace (recv (cat cr (exp (gen) x)))
      (send
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (recv
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (send
        (enc appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (recv
        (enc
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen y)
    (absent (y (exp (gen) x)))))</pre>

<p id="k52">Item <a href="#t52">52</a>, Child: <a href="#k60">60</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc (hash &quot;key handle&quot; (invk authk) username) (cat auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server))) (enc auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server)) (invk authk)) (hash &quot;c ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc username appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server) (hash &quot;s ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)))) (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat (cat sr (exp (gen) y)) (enc (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk))) (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)))</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(cat cr (exp (gen) x))</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((challenge challenge) (cr cr) (sr sr) (username username) (auth auth) (server server) (ca ca) (appid appid) (authk authk) (spk spk) (x x) (y y))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>server-reg</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>uaf-dualbinding-tls13 52</text></svg>
 </div>

<pre>(defskeleton uaf-dualbinding-tls13
  (vars (challenge text) (sr cr data)
    (server ca appid username auth name) (authk spk akey) (y rndx)
    (x expt))
  (defstrand server-reg 5 (challenge challenge) (cr cr) (sr sr)
    (username username) (auth auth) (server server) (ca ca)
    (appid appid) (authk authk) (spk spk) (x x) (y y))
  (absent (y (exp (gen) x)))
  (non-orig (invk authk) (invk spk) (privk ca))
  (uniq-gen y)
  (uniq-orig challenge sr)
  (goals
    (forall
      ((sr data) (challenge text) (authk spk akey)
        (server ca appid name) (y rndx) (z strd))
      (implies
        (and (p &quot;server-reg&quot; z 5) (p &quot;server-reg&quot; &quot;sr&quot; z sr)
          (p &quot;server-reg&quot; &quot;challenge&quot; z challenge)
          (p &quot;server-reg&quot; &quot;authk&quot; z authk) (p &quot;server-reg&quot; &quot;spk&quot; z spk)
          (p &quot;server-reg&quot; &quot;server&quot; z server)
          (p &quot;server-reg&quot; &quot;appid&quot; z appid) (p &quot;server-reg&quot; &quot;ca&quot; z ca)
          (p &quot;server-reg&quot; &quot;y&quot; z y) (non (invk authk)) (non (invk spk))
          (non (privk ca)) (ugen y) (uniq-at challenge z 3)
          (uniq-at sr z 1))
        (exists ((z-0 strd))
          (and (p &quot;client-reg&quot; z-0 5)
            (p &quot;client-reg&quot; &quot;challenge&quot; z-0 challenge)
            (p &quot;client-reg&quot; &quot;server&quot; z-0 server)
            (p &quot;client-reg&quot; &quot;appid&quot; z-0 appid))))))
  (label 52)
  (unrealized (0 4))
  (origs (challenge (0 3)) (sr (0 1)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k60">Item <a href="#t52">60</a>, Parent: <a href="#k52">52</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (hash &quot;key handle&quot; (invk authk) username) (cat auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server))) (enc auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server)) (invk authk)) (hash &quot;c ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc username appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server) (hash &quot;s ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 92.940 264.960 45.960 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)))) (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat (cat sr (exp (gen) y)) (enc (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk))) (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)))</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 92.940 114.960 45.960 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(cat cr (exp (gen) x))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc (hash &quot;key handle&quot; (invk authk) username) (cat auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server))) (enc auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server)) (invk authk)) (hash &quot;c ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <path
   d='M 39.960 339.960 Q 86.940 339.960 133.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc username appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr username appid challenge server) (hash &quot;s ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)))) (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <path
   d='M 39.960 189.960 Q 86.940 189.960 133.920 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat (cat sr (exp (gen) y)) (enc (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk))) (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)))</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(cat cr (exp (gen) x))</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((challenge challenge) (cr cr) (sr sr) (username username) (auth auth) (server server) (ca ca) (appid appid) (authk authk) (spk spk) (x x) (y y))</title>
   <text
    x='139.920' y='77.460'
    style='text-anchor: middle;'>client-reg</text></g>
  <g>
   <title>((challenge challenge) (cr cr) (sr sr) (username username) (auth auth) (server server) (ca ca) (appid appid) (authk authk) (spk spk) (x x) (y y))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>server-reg</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>uaf-dualbinding-tls13 60 (realized)</text>
  </svg></div>

<pre>(defskeleton uaf-dualbinding-tls13
  (vars (challenge text) (cr sr data)
    (ca username auth server appid name) (authk spk akey) (y x rndx))
  (defstrand server-reg 5 (challenge challenge) (cr cr) (sr sr)
    (username username) (auth auth) (server server) (ca ca)
    (appid appid) (authk authk) (spk spk) (x x) (y y))
  (defstrand client-reg 5 (challenge challenge) (cr cr) (sr sr)
    (username username) (auth auth) (server server) (ca ca)
    (appid appid) (authk authk) (spk spk) (x x) (y y))
  (precedes ((0 1) (1 1)) ((0 3) (1 3)) ((1 0) (0 0)) ((1 2) (0 2))
    ((1 4) (0 4)))
  (absent (y (exp (gen) x)))
  (non-orig (invk authk) (invk spk) (privk ca))
  (uniq-gen y x)
  (uniq-orig challenge sr)
  (operation encryption-test (displaced 2 1 client-auth 3)
    (enc
      (hash
        (hash &quot;finished&quot;
          (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))
        (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
        (cat server spk (enc (hash server spk) (privk ca)))
        (enc
          (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk
            (enc (hash server spk) (privk ca))) (invk spk))
        (hash
          (hash &quot;finished&quot;
            (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr))
          (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
          (cat server spk (enc (hash server spk) (privk ca)))
          (enc
            (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
              spk (enc (hash server spk) (privk ca))) (invk spk))))
      (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (0 2))
  (label 60)
  (parent 52)
  (unrealized)
  (shape)
  (satisfies yes)
  (maps
    ((0)
      ((sr sr) (challenge challenge) (authk authk) (spk spk)
        (server server) (ca ca) (appid appid) (y y) (username username)
        (auth auth) (cr cr) (x x))))
  (origs (challenge (0 3)) (sr (0 1))))</pre>

<p id="t140">Tree <a href="#top">140</a>, POV <a href="#k140">140</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k144&quot;, &quot;_self&quot;)'>144</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k140&quot;, &quot;_self&quot;)'>140</text>
  </svg></div>

<pre>(defprotocol uaf-dualbinding-tls13 diffie-hellman
  (defrole client-reg
    (vars (username auth server ca appid name) (challenge text)
      (cr sr data) (authk spk akey) (x rndx) (y expt))
    (trace (send (cat cr (exp (gen) x)))
      (recv
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (send
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (recv
        (enc username appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr username appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (send
        (enc (hash &quot;key handle&quot; (invk authk) username)
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen x))
  (defrole client-auth
    (vars (auth server ca appid name) (challenge text) (cr sr data)
      (authk spk akey) (x rndx) (y expt))
    (trace (send (cat cr (exp (gen) x)))
      (recv
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (send
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (recv
        (enc appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (send
        (enc
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen x))
  (defrole server-reg
    (vars (username auth server ca appid name) (challenge text)
      (cr sr data) (authk spk akey) (x expt) (y rndx))
    (trace (recv (cat cr (exp (gen) x)))
      (send
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (recv
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (send
        (enc username appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr username appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (recv
        (enc (hash &quot;key handle&quot; (invk authk) username)
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr username appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen y)
    (absent (y (exp (gen) x))))
  (defrole server-auth
    (vars (auth server ca appid name) (challenge text) (cr sr data)
      (authk spk akey) (x expt) (y rndx))
    (trace (recv (cat cr (exp (gen) x)))
      (send
        (cat (cat sr (exp (gen) y))
          (enc (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk)))
            (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))))
      (recv
        (enc
          (hash
            (hash &quot;finished&quot;
              (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr))
            (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
            (cat server spk (enc (hash server spk) (privk ca)))
            (enc
              (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
                spk (enc (hash server spk) (privk ca))) (invk spk))
            (hash
              (hash &quot;finished&quot;
                (hash (exp (gen) (mul x y)) &quot;s hs traffic&quot; cr sr))
              (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
              (cat server spk (enc (hash server spk) (privk ca)))
              (enc
                (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
                  server spk (enc (hash server spk) (privk ca)))
                (invk spk))))
          (hash (exp (gen) (mul x y)) &quot;c hs traffic&quot; cr sr)))
      (send
        (enc appid challenge
          (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;) &quot;dual-binding&quot; cr
            sr appid challenge server)
          (hash &quot;s ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;))))
      (recv
        (enc
          (cat auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server)))
          (enc auth authk
            (hash appid challenge
              (hash (hash (exp (gen) (mul x y)) &quot;derived&quot;)
                &quot;dual-binding&quot; cr sr appid challenge server))
            (invk authk))
          (hash &quot;c ap traffic&quot; cr sr
            (hash (exp (gen) (mul x y)) &quot;derived&quot;)))))
    (uniq-gen y)
    (absent (y (exp (gen) x)))))</pre>

<p id="k140">Item <a href="#t140">140</a>, Child: <a href="#k144">144</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc (cat auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server))) (enc auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server)) (invk authk)) (hash &quot;c ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server) (hash &quot;s ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)))) (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat (cat sr (exp (gen) y)) (enc (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk))) (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)))</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(cat cr (exp (gen) x))</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((challenge challenge) (cr cr) (sr sr) (auth auth) (server server) (ca ca) (appid appid) (authk authk) (spk spk) (x x) (y y))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>server-auth</text></g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>uaf-dualbinding-tls13 140</text></svg>
 </div>

<pre>(defskeleton uaf-dualbinding-tls13
  (vars (challenge text) (sr cr data) (server ca appid auth name)
    (authk spk akey) (y rndx) (x expt))
  (defstrand server-auth 5 (challenge challenge) (cr cr) (sr sr)
    (auth auth) (server server) (ca ca) (appid appid) (authk authk)
    (spk spk) (x x) (y y))
  (absent (y (exp (gen) x)))
  (non-orig (invk authk) (invk spk) (privk ca))
  (uniq-gen y)
  (uniq-orig challenge sr)
  (goals
    (forall
      ((sr data) (challenge text) (authk spk akey)
        (server ca appid name) (y rndx) (z strd))
      (implies
        (and (p &quot;server-auth&quot; z 5) (p &quot;server-auth&quot; &quot;sr&quot; z sr)
          (p &quot;server-auth&quot; &quot;challenge&quot; z challenge)
          (p &quot;server-auth&quot; &quot;authk&quot; z authk)
          (p &quot;server-auth&quot; &quot;spk&quot; z spk)
          (p &quot;server-auth&quot; &quot;server&quot; z server)
          (p &quot;server-auth&quot; &quot;appid&quot; z appid) (p &quot;server-auth&quot; &quot;ca&quot; z ca)
          (p &quot;server-auth&quot; &quot;y&quot; z y) (non (invk authk)) (non (invk spk))
          (non (privk ca)) (ugen y) (uniq-at challenge z 3)
          (uniq-at sr z 1))
        (exists ((z-0 strd))
          (and (p &quot;client-auth&quot; z-0 5)
            (p &quot;client-auth&quot; &quot;challenge&quot; z-0 challenge)
            (p &quot;client-auth&quot; &quot;server&quot; z-0 server)
            (p &quot;client-auth&quot; &quot;appid&quot; z-0 appid))))))
  (label 140)
  (unrealized (0 4))
  (origs (challenge (0 3)) (sr (0 1)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k144">Item <a href="#t140">144</a>, Parent: <a href="#k140">140</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (cat auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server))) (enc auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server)) (invk authk)) (hash &quot;c ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server) (hash &quot;s ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 92.940 264.960 45.960 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)))) (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat (cat sr (exp (gen) y)) (enc (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk))) (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)))</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 92.940 114.960 45.960 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(cat cr (exp (gen) x))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc (cat auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server))) (enc auth authk (hash appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server)) (invk authk)) (hash &quot;c ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <path
   d='M 39.960 339.960 Q 86.940 339.960 133.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc appid challenge (hash (hash (exp (gen) (mul y x)) &quot;derived&quot;) &quot;dual-binding&quot; cr sr appid challenge server) (hash &quot;s ap traffic&quot; cr sr (hash (exp (gen) (mul y x)) &quot;derived&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)))) (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <path
   d='M 39.960 189.960 Q 86.940 189.960 133.920 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat (cat sr (exp (gen) y)) (enc (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk)) (hash (hash &quot;finished&quot; (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)) (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) (cat server spk (enc (hash server spk) (privk ca))) (enc (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk (enc (hash server spk) (privk ca))) (invk spk))) (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr)))</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(cat cr (exp (gen) x))</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((challenge challenge) (cr cr) (sr sr) (auth auth) (server server) (ca ca) (appid appid) (authk authk) (spk spk) (x x) (y y))</title>
   <text
    x='139.920' y='77.460'
    style='text-anchor: middle;'>client-auth</text></g>
  <g>
   <title>((challenge challenge) (cr cr) (sr sr) (auth auth) (server server) (ca ca) (appid appid) (authk authk) (spk spk) (x x) (y y))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>server-auth</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>uaf-dualbinding-tls13 144 (realized)</text>
  </svg></div>

<pre>(defskeleton uaf-dualbinding-tls13
  (vars (challenge text) (sr cr data) (server ca appid auth name)
    (authk spk akey) (y x rndx))
  (defstrand server-auth 5 (challenge challenge) (cr cr) (sr sr)
    (auth auth) (server server) (ca ca) (appid appid) (authk authk)
    (spk spk) (x x) (y y))
  (defstrand client-auth 5 (challenge challenge) (cr cr) (sr sr)
    (auth auth) (server server) (ca ca) (appid appid) (authk authk)
    (spk spk) (x x) (y y))
  (precedes ((0 1) (1 1)) ((0 3) (1 3)) ((1 0) (0 0)) ((1 2) (0 2))
    ((1 4) (0 4)))
  (absent (y (exp (gen) x)))
  (non-orig (invk authk) (invk spk) (privk ca))
  (uniq-gen y x)
  (uniq-orig challenge sr)
  (operation encryption-test (displaced 2 1 client-auth 3)
    (enc
      (hash
        (hash &quot;finished&quot;
          (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr))
        (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
        (cat server spk (enc (hash server spk) (privk ca)))
        (enc
          (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server spk
            (enc (hash server spk) (privk ca))) (invk spk))
        (hash
          (hash &quot;finished&quot;
            (hash (exp (gen) (mul y x)) &quot;s hs traffic&quot; cr sr))
          (cat cr (exp (gen) x)) (cat sr (exp (gen) y))
          (cat server spk (enc (hash server spk) (privk ca)))
          (enc
            (hash (cat cr (exp (gen) x)) (cat sr (exp (gen) y)) server
              spk (enc (hash server spk) (privk ca))) (invk spk))))
      (hash (exp (gen) (mul y x)) &quot;c hs traffic&quot; cr sr)) (0 2))
  (label 144)
  (parent 140)
  (unrealized)
  (shape)
  (satisfies yes)
  (maps
    ((0)
      ((sr sr) (challenge challenge) (authk authk) (spk spk)
        (server server) (ca ca) (appid appid) (y y) (auth auth) (cr cr)
        (x x))))
  (origs (challenge (0 3)) (sr (0 1))))</pre>

</body>
</html>
